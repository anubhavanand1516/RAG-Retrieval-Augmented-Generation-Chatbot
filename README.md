
# RAG (Retrieval-Augmented Generation) Chatbot

This project implements a **Retrieval-Augmented Generation (RAG)** chatbot powered by OpenAI's GPT-3 model. The bot fetches relevant documents from a local corpus (stored in a MySQL database) and uses OpenAI for generating answers based on both the query and relevant context.

## How to Install and Run the System Locally on macOS

1. **Clone the Repository**:

   Clone the project repository to your local machine:

   ```bash
   git clone <repo_url>
   cd <repo_directory>
   ```

2. **Set Up a Python Virtual Environment**:

   It is recommended to use a virtual environment to manage dependencies. For macOS, you can use `venv` or `conda`.

   If using **conda**:

   ```bash
   conda create --name rag_env python=3.9
   conda activate rag_env
   ```

   OR if using **venv**:

   ```bash
   python3 -m venv rag_env
   source rag_env/bin/activate
   ```

3. **Install Required Dependencies**:

   Install all the required dependencies listed in the `requirements.txt` file:

   ```bash
   pip install -r requirements.txt
   ```

4. **Install MySQL on macOS**:

   If you donâ€™t have MySQL installed, you can install it using **Homebrew**:

   ```bash
   brew install mysql
   ```

   After installation, start MySQL with:

   ```bash
   brew services start mysql
   ```

   Then, log into MySQL to create a database:

   ```bash
   mysql -u root -p
   CREATE DATABASE chatbot_db;
   ```

5. **Create Required Tables**:

   Create a table for storing chat history:

   ```sql
   CREATE TABLE IF NOT EXISTS chat_history (
       id INT AUTO_INCREMENT PRIMARY KEY,
       timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       role ENUM('user', 'system'),
       content TEXT
   );
   ```

6. **Set Environment Variables for macOS**:

   For security, store the OpenAI API key and database credentials as environment variables. On macOS, you can add them to your shell configuration (e.g., `.zshrc` or `.bash_profile`):

   Open `.zshrc` or `.bash_profile` using a text editor (e.g., `nano` or `vim`):

   ```bash
   nano ~/.zshrc  # For Zsh users
   ```

   Or for Bash users:

   ```bash
   nano ~/.bash_profile
   ```

   Add the following lines (replace the placeholder values with your actual API key and database credentials):

   ```bash
   export OPENAI_API_KEY="your-openai-api-key-here"
   export DB_HOST="localhost"
   export DB_USER="your-db-username"
   export DB_PASSWORD="your-db-password"
   export DB_NAME="chatbot_db"
   ```

   After saving the file, reload the configuration:

   ```bash
   source ~/.zshrc  # For Zsh users
   ```

   Or for Bash users:

   ```bash
   source ~/.bash_profile
   ```

7. **Run the Flask Application**:

   Once everything is set up, you can start the Flask application:

   ```bash
   python rag_chatbot.py
   ```

   The application will be running on `http://127.0.0.1:5000/`.

## How to Test the `/chat` and `/history` Endpoints

### Testing `/chat` Endpoint

1. **Using HTTPie**:

   Install HTTPie if you don't have it:

   ```bash
   brew install httpie
   ```

   Send a POST request to the `/chat` endpoint:

   ```bash
   http POST http://127.0.0.1:5000/chat query="What is artificial intelligence?"
   ```

   The response will be a dynamic answer generated by OpenAI based on your query and the relevant corpus documents.

2. **Using Postman**:

   - Set the request type to `POST`.
   - Set the URL to `http://127.0.0.1:5000/chat`.
   - In the body of the request, select `raw` and set the format to `JSON`. Then, use the following data:

     ```json
     {
       "query": "What is artificial intelligence?"
     }
     ```

   You should get a dynamic response.

### Testing `/history` Endpoint

To view the stored chat history from the MySQL database:

```bash
http GET http://127.0.0.1:5000/history
```

This will return all conversations stored in the `chat_history` table.

## Troubleshooting Common Issues

1. **No API Key Provided**:
   - Ensure the OpenAI API key is set correctly as an environment variable. Check if the key is correctly added in `.zshrc` or `.bash_profile`.

   Example:

   ```bash
   export OPENAI_API_KEY="your-openai-api-key-here"
   ```

2. **MySQL Connection Errors**:
   - Ensure MySQL is running (`brew services start mysql`) and that the credentials in the environment variables are correct.

   To test MySQL connection:

   ```bash
   mysql -u your-db-username -p
   ```

3. **Quota Exceeded (OpenAI)**:
   - If you exceed your OpenAI API quota, you will need to either wait for your quota to reset or upgrade your OpenAI plan.

   Check your usage in your OpenAI account dashboard: [OpenAI API Keys](https://platform.openai.com/account/api-keys).

## Required Environment Variables

Make sure the following environment variables are set:

- **OPENAI_API_KEY**: Your OpenAI API key (generated at [OpenAI Platform](https://platform.openai.com/)).
- **DB_HOST**: The host of your MySQL server (usually `localhost`).
- **DB_USER**: Your MySQL username (e.g., `root`).
- **DB_PASSWORD**: Your MySQL password.
- **DB_NAME**: The name of the database (e.g., `chatbot_db`).

## Conclusion

You have successfully set up and run the RAG chatbot locally on your macOS. If you run into any issues, check the logs for error messages, and feel free to reach out if further help is needed.
